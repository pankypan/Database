# MySQL_06_选择数据类型

## CHAR与VARCHAR

`CHAR 和VARCHAR` 类型类似，都用来存储字符串，但它们保存和检索的方式不同。`CHAR`属于固定长度的字符类型，而`VARCHAR` 属于可变长度的字符类型。

由于`CHAR` 是固定长度的，所以它的处理速度比`VARCHAR` 快得多，但是其缺点是浪费存储空间，程序需要对行尾空格进行处理，所以对于那些长度变化不大并且对查询速度有较高要求的数据可以考虑使用`CHAR `类型来存储。

随着MySQL 版本的不断升级，`VARCHAR `数据类型的性能也在不断改进并提高，所以在许多的应用中，`VARCHAR `类型被更多地使用。

不同的存储引擎对CHAR 和VARCHAR 的使用原则:

- InnoDB 存储引擎：建议使用VARCHAR 类型。

  ```sql
  -- 对于InnoDB 数据表，内部的行存储格式没有区分固定长度和可变长度列（所有数据行都使用指向数据列值的头指针），因此在本质上，使用固定长度的CHAR 列不一定比使用可变长度VARCHAR 列性能要好。因而，主要的性能因素是数据行使用的存储总量。由于CHAR 平均占用的空间多于VARCHAR，因此使用VARCHAR 来最小化需要处理的数据行的存储总量和磁盘I/O 是比较好的。
  ```

- MyISAM 存储引擎：建议使用固定长度的数据列代替可变长度的数据列。

- MEMORY 存储引擎：目前都使用固定长度的数据行存储，因此无论使用CHAR 或VARCHAR 列都没有关系。两者都是作为CHAR 类型处理。



## TEXT与BLOB

在保存较大文本时，通常会选择使用TEXT 或者BLOB，二者之间的主要差别是BLOB 能用来保存二进制数据，比如照片；而TEXT 只能保存字符数据，比如一篇文章或者日记。

`TEXT 和BLOB `中有分别包括`TEXT、MEDIUMTEXT、LONGTEXT 和BLOB、MEDIUMBLOB、LONGBLOB3 `种不同的类型

**BLOB 和TEXT 存在的一些常见问题:**

- BLOB 和TEXT 值会引起一些性能问题，特别是在执行了大量的删除操作时。

  ```sql
  -- 删除操作会在数据表中留下很大的“空洞”，以后填入这些“空洞”的记录在插入的性能上会有影响。为了提高性能，建议定期使用OPTIMIZE TABLE 功能对这类表进行碎片整理，避免因为“空洞”导致性能问题。
  ```

- 可以使用合成的（Synthetic）索引来提高大文本字段（BLOB 或TEXT）的查询性能。

  ```sql
  -- 简单来说，合成索引就是根据大文本字段的内容建立一个散列值，并把这个值存储在单独的数据列中，接下来就可以通过检索散列值找到数据行了。但是，要注意这种技术只能用于精确匹配的查询（散列值对于类似<或>=等范围搜索操作符是没有用处的）。可以使用MD5()函数生成散列值，也可以使用SHA1()或CRC32()，或者使用自己的应用程序逻辑来计算散列值。请记住数值型散列值可以很高效率地存储。同样，如果散列算法生成的字符串带有尾部空格，就不要把它们存储在CHAR 或VARCHAR 列中，它们会受到尾部空格去除的影响。合成的散列索引对于那些BLOB 或TEXT 数据列特别有用。用散列标识符值查找的速度比搜索BLOB 列本身的速度快很多。
  ```

- 在不必要的时候避免检索大型的BLOB 或TEXT 值。

  ```sql
  -- 例如，SELECT * 查询就不是很好的想法，除非能够确定作为约束条件的WHERE 子句只会找到所需要的数据行。否则，很可能毫无目的地在网络上传输大量的值。这也是BLOB 或TEXT标识符信息存储在合成的索引列中对用户有所帮助的例子。用户可以搜索索引列，决定需要的哪些数据行，然后从符合条件的数据行中检索BLOB 或TEXT 值。
  ```

- 把BLOB 或TEXT 列分离到单独的表中。

  ```sql
  -- 在某些环境中，如果把这些数据列移动到第二张数据表中，可以把原数据表中的数据列转换为固定长度的数据行格式，那么它就是有意义的。这会减少主表中的碎片，可以得到固定长度数据行的性能优势。它还可以使主数据表在运行SELECT * 查询的时候不会通过网络传输大量的BLOB 或TEXT 值。
  ```





## 浮点数与定点数

浮点数一般用于表示含有小数部分的数值。当一个字段被定义为浮点类型后，如果插入数据的精度超过该列定义的实际精度，则插入值会被四舍五入到实际定义的精度值，然后插入，四舍五入的过程不会报错。`float  double  real`

定点数实际上是以字符串形式存放的，所以定点数可以更加精确的保存数据。如果实际插入的数值精度大于实际定义的精度，则MySQL 会进行警告（默认的SQLMode 下），但是数据按照实际精度四舍五入后插入。`decimal`

```sql
create table t (f float(8, 1));

desc t;

insert into t values (1.23456);
select * from t;

insert into t values(1.2566);
select * from t;
```

```sql
create table test (c1 float(10, 2), c2 decimal(10, 2));

insert into test values(123.32, 123.32);
select * from test;
```

```sql
-- 注意：在今后关于浮点数和定点数的应用中，用户要考虑到以下几个原则：
-- 浮点数存在误差问题；
-- 对货币等对精度敏感的数据，应该用定点数表示或存储；
-- 在编程中，如果用到浮点数，要特别注意误差问题，并尽量避免做浮点数比较；
-- 要注意浮点数中一些特殊值的处理。
```





## 日期类型选择

MySQL 提供的常用日期类型有DATE、TIME 、DATETIME、TIMESTAMP

**选择日期类型的原则:**

- 根据实际需要选择能够满足应用的最小存储的日期类型。如果应用只需要记录“年份”，那么用1 个字节来存储的YEAR 类型完全可以满足，而不需要用4 个字节来存储的DATE 类型。这样不仅仅能节约存储，更能够提高表的操作效率。
- 如果要记录年月日时分秒，并且记录的年份比较久远，那么最好使用DATETIME，而不要使用TIMESTAMP。因为TIMESTAMP 表示的日期范围比DATETIME 要短得多。
- 如果记录的日期需要让不同时区的用户使用，那么最好使用TIMESTAMP，因为日期类型中只有它能够和实际时区相对应。











